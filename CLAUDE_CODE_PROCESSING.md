# Claude Code Log Processing Documentation

## Overview

This document explains how the Claude Code Log Viewer processes JSONL files generated by Claude Code CLI, transforming them from raw JSON Lines format into human-readable Markdown.

## Claude Code CLI Background

**Claude Code CLI** is Anthropic's command-line interface tool that enables developers to interact with Claude directly from their terminal. All conversations are automatically saved as JSONL (JSON Lines) files in the `~/.claude/projects/` directory.

### Storage Structure
```
~/.claude/projects/
â”œâ”€â”€ default_20241215_123456.jsonl
â”œâ”€â”€ project_name_20241216_094523.jsonl
â””â”€â”€ ...
```

## JSONL File Format

Claude Code stores each message as a separate JSON object on its own line:

```jsonl
{"type":"user","message":{"role":"user","content":"Help me debug this function"},"sessionId":"default_20241215_123456","timestamp":1702654321000}
{"type":"assistant","message":{"content":[{"type":"text","text":"I'll help you debug..."}]},"sessionId":"default_20241215_123456","timestamp":1702654325000}
{"type":"summary","summary":"Debugging session for JavaScript function","sessionId":"default_20241215_123456"}
```

## Processing Pipeline

### 1. Session Metadata Extraction

The converter first identifies and extracts session-level information:

```javascript
// Extracted from first message with sessionId
Session ID: default_20241215_123456
Branch: main
Working Directory: /Users/developer/project
```

### 2. Message Type Handling

#### User Messages
- Standard user queries and responses
- Command executions (like `/model`, `/clear`)
- Tool result submissions

#### Assistant Messages
- Text responses
- Tool use declarations with parameters
- Multi-part responses with code and explanations

#### Summary Messages
- Auto-generated session summaries
- Displayed as section headers in output

### 3. Special Command Processing

#### Model Changes (`/model` command)
When users switch Claude models, the tool:
1. Detects the `/model` command in message content
2. Extracts the model change from `<local-command-stdout>` tags
3. Formats it as a highlighted model change notification

**Raw:**
```xml
<command-name>/model</command-name>
<local-command-stdout>Set model to claude-3-opus-20240229</local-command-stdout>
```

**Processed:**
```markdown
### ðŸ”„ Model Changed
_Set model to claude-3-opus-20240229 per user request_
```

### 4. Tool Use Formatting

Claude Code frequently uses tools (file operations, code execution, etc.). The converter:

1. **Tool Invocations**: Formats tool calls with their parameters
2. **Tool Results**: Displays outputs in code blocks
3. **Preserves Tool IDs**: Maintains reference IDs for tracking

**Example Processing:**
```markdown
**Tool Use:** file_read
*Tool ID: tool_abc123*

```json
{
  "path": "/src/main.js",
  "encoding": "utf-8"
}
```
```

### 5. Timestamp Preservation

All timestamps are converted from Unix milliseconds to human-readable format:
- Format: `MM/DD/YYYY, HH:MM:SS AM/PM`
- Displayed inline with message headers

## Output Format Structure

The final Markdown follows this structure:

```markdown
# Chat Conversation Log

**Session ID:** [id]
**Branch:** [git branch]
**Working Directory:** [path]

---

### ðŸ‘¤ User - 12/15/2024, 3:45:21 PM
[User message content]

---

### ðŸ¤– Assistant - 12/15/2024, 3:45:25 PM
[Assistant response]

**Tool Use:** [tool name]
[Tool parameters and results]

---
```

## Features Implemented

### Multi-File Management
- Unique ID generation for each uploaded file
- Concurrent processing of multiple sessions
- File metadata preservation (size, last modified)

### Search Functionality
- Full-text search across all loaded files
- Line-by-line matching with snippet extraction
- Result highlighting and match counting

### Export Capabilities
- Individual file export to Markdown
- Batch export of all converted files
- Combined export with session separation

### User Experience
- Drag-and-drop file upload
- Inline file renaming
- Sort by date, name, or size
- Responsive design for mobile/desktop

## Error Handling

The converter includes robust error handling for:
- Invalid JSON lines (skips with warning)
- Missing required fields (uses defaults)
- Malformed tool use data (displays raw content)
- Empty or corrupted files (shows error message)

## Privacy & Security

- **Client-Side Processing**: All conversion happens in the browser
- **No Data Transmission**: Files never leave your device
- **No Storage**: Files are only kept in browser memory during session
- **Secure by Design**: No backend servers or databases involved

## Technical Implementation

Built with:
- **React**: For reactive UI updates
- **TypeScript**: For type safety and better error detection
- **Next.js**: For optimized performance and routing
- **Tailwind CSS**: For consistent styling with Everforest theme

## Use Cases

1. **Code Review**: Review Claude's code suggestions and implementations
2. **Documentation**: Extract solutions for team knowledge bases
3. **Debugging**: Trace back through problem-solving sessions
4. **Learning**: Study interaction patterns and Claude's responses
5. **Compliance**: Archive conversations for audit purposes

---

*This tool bridges the gap between Claude Code's powerful CLI capabilities and the need for readable conversation history, making AI-assisted development more transparent and shareable.*